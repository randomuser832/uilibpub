local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local mouse = player:GetMouse()

-- UI Library Table
local UILibrary = {}
UILibrary.Tabs = {}

-- Keybind toggle
local ToggleKey = Enum.KeyCode.LeftControl
local UIVisible = true

-- Create UI
function UILibrary:Create(title)
	local screenGui = Instance.new("ScreenGui", game:GetService("CoreGui"))
	screenGui.Name = "UILibrary_Main"
	screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

	local mainFrame = Instance.new("Frame", screenGui)
	mainFrame.Name = "Main"
	mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
	mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
	mainFrame.Size = UDim2.new(0, 600, 0, 400)
	mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	mainFrame.BorderSizePixel = 0
	mainFrame.ClipsDescendants = true

	local uicorner = Instance.new("UICorner", mainFrame)
	uicorner.CornerRadius = UDim.new(0, 12)

	local titleLabel = Instance.new("TextLabel", mainFrame)
	titleLabel.Text = title
	titleLabel.Size = UDim2.new(1, 0, 0, 40)
	titleLabel.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
	titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	titleLabel.TextScaled = true
	titleLabel.BorderSizePixel = 0
	local corner = Instance.new("UICorner", titleLabel)
	corner.CornerRadius = UDim.new(0, 12)

	local minimize = Instance.new("TextButton", mainFrame)
	minimize.Text = "-"
	minimize.Size = UDim2.new(0, 30, 0, 30)
	minimize.Position = UDim2.new(1, -35, 0, 5)
	minimize.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	minimize.TextColor3 = Color3.fromRGB(255, 255, 255)
	minimize.BorderSizePixel = 0
	local uic = Instance.new("UICorner", minimize)
	uic.CornerRadius = UDim.new(1, 0)

	local tabsFrame = Instance.new("Frame", mainFrame)
	tabsFrame.Name = "Tabs"
	tabsFrame.Position = UDim2.new(0, 0, 0, 40)
	tabsFrame.Size = UDim2.new(0, 150, 1, -40)
	tabsFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
	tabsFrame.BorderSizePixel = 0
	Instance.new("UICorner", tabsFrame).CornerRadius = UDim.new(0, 12)

	local tabButtonsLayout = Instance.new("UIListLayout", tabsFrame)
	tabButtonsLayout.SortOrder = Enum.SortOrder.LayoutOrder
	tabButtonsLayout.Padding = UDim.new(0, 5)

	local contentFrame = Instance.new("Frame", mainFrame)
	contentFrame.Name = "Content"
	contentFrame.Position = UDim2.new(0, 160, 0, 50)
	contentFrame.Size = UDim2.new(1, -170, 1, -60)
	contentFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
	contentFrame.BorderSizePixel = 0
	contentFrame.ClipsDescendants = true
	Instance.new("UICorner", contentFrame).CornerRadius = UDim.new(0, 12)

	-- Minimize Function
	local collapsed = false
	minimize.MouseButton1Click:Connect(function()
		local goal = collapsed and UDim2.new(0, 600, 0, 400) or UDim2.new(0, 0, 0, 0)
		TweenService:Create(mainFrame, TweenInfo.new(0.3), {Size = goal}):Play()
		collapsed = not collapsed
	end)

	-- Toggle Key Handler
	UserInputService.InputBegan:Connect(function(input, processed)
		if not processed and input.KeyCode == ToggleKey then
			screenGui.Enabled = not screenGui.Enabled
			UIVisible = screenGui.Enabled
		end
	end)

	-- Add Tab Function
	function UILibrary:AddTab(name)
		local tab = {}
		local tabButton = Instance.new("TextButton", tabsFrame)
		tabButton.Text = name
		tabButton.Size = UDim2.new(1, -10, 0, 30)
		tabButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
		tabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
		tabButton.BorderSizePixel = 0
		Instance.new("UICorner", tabButton).CornerRadius = UDim.new(0, 8)

		local tabContent = Instance.new("Frame", contentFrame)
		tabContent.Name = name
		tabContent.Size = UDim2.new(1, 0, 1, 0)
		tabContent.Visible = false
		tabContent.BackgroundTransparency = 1

		local layout = Instance.new("UIListLayout", tabContent)
		layout.SortOrder = Enum.SortOrder.LayoutOrder
		layout.Padding = UDim.new(0, 6)

		tabButton.MouseButton1Click:Connect(function()
			for _, t in pairs(contentFrame:GetChildren()) do
				if t:IsA("Frame") then
					t.Visible = false
				end
			end
			tabContent.Visible = true
		end)

		function tab:AddLabel(text)
			local label = Instance.new("TextLabel", tabContent)
			label.Size = UDim2.new(1, 0, 0, 25)
			label.BackgroundTransparency = 1
			label.TextColor3 = Color3.new(1, 1, 1)
			label.Text = text
			label.TextScaled = true
		end

		function tab:AddButton(text, callback)
			local btn = Instance.new("TextButton", tabContent)
			btn.Size = UDim2.new(1, 0, 0, 30)
			btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
			btn.Text = text
			btn.TextColor3 = Color3.new(1, 1, 1)
			btn.BorderSizePixel = 0
			Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)
			btn.MouseButton1Click:Connect(callback)
		end

		function tab:AddTextbox(placeholder, callback)
			local textbox = Instance.new("TextBox", tabContent)
			textbox.Size = UDim2.new(1, 0, 0, 30)
			textbox.PlaceholderText = placeholder
			textbox.Text = ""
			textbox.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
			textbox.TextColor3 = Color3.fromRGB(255, 255, 255)
			Instance.new("UICorner", textbox).CornerRadius = UDim.new(0, 6)
			textbox.FocusLost:Connect(function(enter)
				if enter then
					callback(textbox.Text)
				end
			end)
		end

		function tab:AddDropdown(label, options, callback)
			local dropdown = Instance.new("TextButton", tabContent)
			dropdown.Size = UDim2.new(1, 0, 0, 30)
			dropdown.Text = label
			dropdown.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
			dropdown.TextColor3 = Color3.new(1, 1, 1)
			Instance.new("UICorner", dropdown).CornerRadius = UDim.new(0, 6)

			local menu = Instance.new("Frame", dropdown)
			menu.Visible = false
			menu.Position = UDim2.new(0, 0, 1, 0)
			menu.Size = UDim2.new(1, 0, 0, #options * 25)
			menu.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
			Instance.new("UICorner", menu).CornerRadius = UDim.new(0, 6)

			for _, option in ipairs(options) do
				local opt = Instance.new("TextButton", menu)
				opt.Size = UDim2.new(1, 0, 0, 25)
				opt.Text = option
				opt.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
				opt.TextColor3 = Color3.fromRGB(255, 255, 255)
				opt.MouseButton1Click:Connect(function()
					callback(option)
					menu.Visible = false
				end)
			end

			dropdown.MouseButton1Click:Connect(function()
				menu.Visible = not menu.Visible
			end)
		end

		tabContent.Visible = #contentFrame:GetChildren() == 1
		return tab
	end

	-- Create Settings and Credits Tabs
	local settingsTab = UILibrary:AddTab("Settings")
	settingsTab:AddLabel("UI Toggle Key (Default: LeftControl)")
	settingsTab:AddTextbox("Enter Key (e.g., F)", function(input)
		if input and input ~= "" then
			local key = Enum.KeyCode[input]
			if key then
				ToggleKey = key
				warn("UI Toggle Key updated to:", key.Name)
			else
				warn("Invalid key input.")
			end
		else
			ToggleKey = Enum.KeyCode.LeftControl
			warn("Reset to default key: LeftControl")
		end
	end)

	local creditsTab = UILibrary:AddTab("Credits")
	creditsTab:AddLabel("Script by: Tyrone_darealest")

	return UILibrary
end
