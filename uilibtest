-- IreXion UI Library (All-in-One)
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")

local library = {}
library.theme = {
    MainColor = Color3.fromRGB(30, 30, 30),
    TabColor = Color3.fromRGB(20, 20, 20),
    SectionColor = Color3.fromRGB(40, 40, 40),
    AccentColor = Color3.fromRGB(0, 255, 0),
    FontColor = Color3.fromRGB(255, 255, 255),
    ToggleOn = Color3.fromRGB(0, 255, 0),
    ToggleOff = Color3.fromRGB(80, 80, 80)
}

-- Create main GUI container
local gui = Instance.new("ScreenGui")
gui.Name = "IreXionUILib"
gui.ResetOnSpawn = false
gui.Parent = CoreGui
gui.Enabled = true

-- Main Frame
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 450, 0, 300)
mainFrame.Position = UDim2.new(0.5, -225, 0.5, -150)
mainFrame.BackgroundColor3 = library.theme.MainColor
mainFrame.BorderSizePixel = 0
mainFrame.Parent = gui
mainFrame.ClipsDescendants = true

-- State for minimized or not
local isMinimized = false

-- Header
local header = Instance.new("Frame")
header.Size = UDim2.new(1, 0, 0, 30)
header.BackgroundColor3 = library.theme.TabColor
header.BorderSizePixel = 0
header.Parent = mainFrame

local headerLabel = Instance.new("TextLabel")
headerLabel.Size = UDim2.new(1, -60, 1, 0)
headerLabel.Position = UDim2.new(0, 10, 0, 0)
headerLabel.BackgroundTransparency = 1
headerLabel.Text = "IreXion - UI Library"
headerLabel.TextColor3 = library.theme.FontColor
headerLabel.TextXAlignment = Enum.TextXAlignment.Left
headerLabel.Font = Enum.Font.SourceSansBold
headerLabel.TextSize = 18
headerLabel.Parent = header

local minimizeBtn = Instance.new("TextButton")
minimizeBtn.Size = UDim2.new(0, 50, 1, 0)
minimizeBtn.Position = UDim2.new(1, -50, 0, 0)
minimizeBtn.BackgroundColor3 = library.theme.TabColor
minimizeBtn.TextColor3 = library.theme.FontColor
minimizeBtn.Text = "â€”"
minimizeBtn.Font = Enum.Font.SourceSansBold
minimizeBtn.TextSize = 24
minimizeBtn.BorderSizePixel = 0
minimizeBtn.Parent = header

-- Side Tab List
local tabList = Instance.new("Frame")
tabList.Size = UDim2.new(0, 100, 1, -30)
tabList.Position = UDim2.new(0, 0, 0, 30)
tabList.BackgroundColor3 = library.theme.SectionColor
tabList.BorderSizePixel = 0
tabList.Parent = mainFrame

local tabListLayout = Instance.new("UIListLayout")
tabListLayout.Padding = UDim.new(0, 5)
tabListLayout.SortOrder = Enum.SortOrder.LayoutOrder
tabListLayout.Parent = tabList

-- Content Frame (holds tabs content)
local contentFrame = Instance.new("Frame")
contentFrame.Size = UDim2.new(1, -100, 1, -30)
contentFrame.Position = UDim2.new(0, 100, 0, 30)
contentFrame.BackgroundColor3 = library.theme.MainColor
contentFrame.BorderSizePixel = 0
contentFrame.ClipsDescendants = true
contentFrame.Parent = mainFrame

local contentUIList = Instance.new("UIListLayout")
contentUIList.SortOrder = Enum.SortOrder.LayoutOrder
contentUIList.Parent = contentFrame

-- Notification Container (top-right corner)
local notificationContainer = Instance.new("Frame")
notificationContainer.AnchorPoint = Vector2.new(1, 0)
notificationContainer.Position = UDim2.new(1, -10, 0, 10)
notificationContainer.Size = UDim2.new(0, 250, 0, 0)
notificationContainer.BackgroundTransparency = 1
notificationContainer.Parent = gui

local notificationLayout = Instance.new("UIListLayout")
notificationLayout.SortOrder = Enum.SortOrder.LayoutOrder
notificationLayout.VerticalAlignment = Enum.VerticalAlignment.Top
notificationLayout.Padding = UDim.new(0, 5)
notificationLayout.Parent = notificationContainer

-- Internal tab tracking
local tabs = {}
local tabButtons = {}

-- Helper function: TweenSize for sliding tab transition
local function slideTab(oldTab, newTab)
    if oldTab then
        -- Slide oldTab left and hide
        TweenService:Create(oldTab, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut),
            {Position = UDim2.new(-1, 0, 0, 0)}):Play()
        delay(0.25, function() oldTab.Visible = false end)
    end
    -- Prepare newTab to right and show
    newTab.Position = UDim2.new(1, 0, 0, 0)
    newTab.Visible = true
    -- Slide newTab in from right to center
    TweenService:Create(newTab, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut),
        {Position = UDim2.new(0, 0, 0, 0)}):Play()
end

-- Create Tab function
function library:CreateTab(name)
    -- Content Frame for this tab
    local tabFrame = Instance.new("Frame")
    tabFrame.Name = name
    tabFrame.Size = UDim2.new(1, 0, 1, 0)
    tabFrame.Position = UDim2.new(1, 0, 0, 0) -- Start off-screen right
    tabFrame.BackgroundTransparency = 1
    tabFrame.Visible = false
    tabFrame.Parent = contentFrame

    -- Padding for content inside tab
    local padding = Instance.new("UIPadding")
    padding.PaddingTop = UDim.new(0, 10)
    padding.PaddingLeft = UDim.new(0, 10)
    padding.PaddingRight = UDim.new(0, 10)
    padding.PaddingBottom = UDim.new(0, 10)
    padding.Parent = tabFrame

    -- Layout for content
    local layout = Instance.new("UIListLayout")
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    layout.Padding = UDim.new(0, 6)
    layout.Parent = tabFrame

    -- Create tab button on side panel
    local tabBtn = Instance.new("TextButton")
    tabBtn.Size = UDim2.new(1, 0, 0, 30)
    tabBtn.BackgroundColor3 = library.theme.TabColor
    tabBtn.TextColor3 = library.theme.FontColor
    tabBtn.Font = Enum.Font.SourceSans
    tabBtn.TextSize = 16
    tabBtn.Text = name
    tabBtn.BorderSizePixel = 0
    tabBtn.Parent = tabList

    -- Add to internal tables
    tabs[#tabs + 1] = tabFrame
    tabButtons[#tabButtons + 1] = tabBtn

    -- Tab button click handler
    tabBtn.MouseButton1Click:Connect(function()
        local currentTab = nil
        for _, t in ipairs(tabs) do
            if t.Visible then
                currentTab = t
                break
            end
        end
        if currentTab ~= tabFrame then
            slideTab(currentTab, tabFrame)
        end
    end)

    -- If first tab, show it
    if #tabs == 1 then
        tabFrame.Visible = true
        tabFrame.Position = UDim2.new(0, 0, 0, 0)
    end

    -- Return the tab Frame for adding components
    return tabFrame
end

-- Create Label inside a tab
function library:CreateLabel(tab, text)
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 0, 20)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = library.theme.FontColor
    label.Font = Enum.Font.SourceSans
    label.TextSize = 16
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = tab
    return label
end

-- Create Button inside a tab
function library:CreateButton(tab, text, callback)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, 0, 0, 30)
    button.BackgroundColor3 = library.theme.SectionColor
    button.TextColor3 = library.theme.FontColor
    button.Font = Enum.Font.SourceSans
    button.TextSize = 16
    button.Text = text
    button.BorderSizePixel = 0
    button.Parent = tab
    if callback then
        button.MouseButton1Click:Connect(callback)
    end
    return button
end

-- Create Toggle Switch inside a tab
function library:CreateToggle(tab, text, default, callback)
    local container = Instance.new("Frame")
    container.Size = UDim2.new(1, 0, 0, 30)
    container.BackgroundTransparency = 1
    container.Parent = tab

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, -50, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = library.theme.FontColor
    label.Font = Enum.Font.SourceSans
    label.TextSize = 16
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = container

    local toggle = Instance.new("Frame")
    toggle.Size = UDim2.new(0, 40, 0, 20)
    toggle.BackgroundColor3 = default and library.theme.ToggleOn or library.theme.ToggleOff
    toggle.Position = UDim2.new(1, -45, 0, 5)
    toggle.BorderSizePixel = 0
    toggle.Parent = container
    toggle.ClipsDescendants = true
    toggle.Cursor = "PointingHand"

    local circle = Instance.new("Frame")
    circle.Size = UDim2.new(0, 16, 0, 16)
    circle.BackgroundColor3 = Color3.fromRGB(240, 240, 240)
    circle.Position = default and UDim2.new(1, -21, 0, 2) or UDim2.new(0, 2, 0, 2)
    circle.AnchorPoint = Vector2.new(0, 0)
    circle.BorderSizePixel = 0
    circle.Parent = toggle

    local toggled = default

    local function updateVisual()
        toggle.BackgroundColor3 = toggled and library.theme.ToggleOn or library.theme.ToggleOff
        local goalPos = toggled and UDim2.new(1, -21, 0, 2) or UDim2.new(0, 2, 0, 2)
        TweenService:Create(circle, TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut), {Position = goalPos}):Play()
    end

    toggle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            toggled = not toggled
            updateVisual()
            if callback then callback(toggled) end
        end
    end)

    updateVisual()

    return container
end

-- Create Slider inside a tab
function library:CreateSlider(tab, text, min, max, default, callback)
    local container = Instance.new("Frame")
    container.Size = UDim2.new(1, 0, 0, 40)
    container.BackgroundTransparency = 1
    container.Parent = tab

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 0, 14)
    label.BackgroundTransparency = 1
    label.Text = text .. ": " .. tostring(default)
    label.TextColor3 = library.theme.FontColor
    label.Font = Enum.Font.SourceSans
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = container

    local sliderBg = Instance.new("Frame")
    sliderBg.Size = UDim2.new(1, 0, 0, 14)
    sliderBg.Position = UDim2.new(0, 0, 0, 18)
    sliderBg.BackgroundColor3 = library.theme.SectionColor
    sliderBg.BorderSizePixel = 0
    sliderBg.Parent = container
    sliderBg.ClipsDescendants = true
    sliderBg.Cursor = "PointingHand"

    local sliderFill = Instance.new("Frame")
    sliderFill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
    sliderFill.BackgroundColor3 = library.theme.AccentColor
    sliderFill.BorderSizePixel = 0
    sliderFill.Parent = sliderBg

    local dragging = false

    local function updateValue(x)
        local relativeX = math.clamp(x - sliderBg.AbsolutePosition.X, 0, sliderBg.AbsoluteSize.X)
        local percent = relativeX / sliderBg.AbsoluteSize.X
        local value = math.floor(min + (max - min) * percent)
        sliderFill:TweenSize(UDim2.new(percent, 0, 1, 0), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.15, true)
        label.Text = text .. ": " .. tostring(value)
        if callback then callback(value) end
    end

    sliderBg.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            updateValue(input.Position.X)
        end
    end)
    sliderBg.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    sliderBg.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            updateValue(input.Position.X)
        end
    end)

    -- Initialize slider fill size
    sliderFill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)

    return container
end

-- Create Input Box (supports text and numbers)
function library:CreateInputBox(tab, text, default, callback, numberOnly)
    local container = Instance.new("Frame")
    container.Size = UDim2.new(1, 0, 0, 40)
    container.BackgroundTransparency = 1
    container.Parent = tab

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, -10, 0, 14)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = library.theme.FontColor
    label.Font = Enum.Font.SourceSans
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = container

    local inputBox = Instance.new("TextBox")
    inputBox.Size = UDim2.new(1, 0, 0, 20)
    inputBox.Position = UDim2.new(0, 0, 0, 18)
    inputBox.BackgroundColor3 = library.theme.SectionColor
    inputBox.TextColor3 = library.theme.FontColor
    inputBox.Text = tostring(default or "")
    inputBox.ClearTextOnFocus = false
    inputBox.Font = Enum.Font.SourceSans
    inputBox.TextSize = 16
    inputBox.BorderSizePixel = 0
    inputBox.Parent = container

    if numberOnly then
        inputBox.FocusLost:Connect(function(enterPressed)
            local num = tonumber(inputBox.Text)
            if num then
                inputBox.Text = tostring(num)
                if callback then callback(num) end
            else
                inputBox.Text = tostring(default or "")
            end
        end)
    else
        inputBox.FocusLost:Connect(function(enterPressed)
            if callback then callback(inputBox.Text) end
        end)
    end

    return container
end

-- Create Dropdown (single-select)
function library:CreateDropdown(tab, text, options, defaultIndex, callback)
    local container = Instance.new("Frame")
    container.Size = UDim2.new(1, 0, 0, 35)
    container.BackgroundTransparency = 1
    container.Parent = tab

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.4, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = library.theme.FontColor
    label.Font = Enum.Font.SourceSans
    label.TextSize = 16
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = container

    local dropdownBtn = Instance.new("TextButton")
    dropdownBtn.Size = UDim2.new(0.6, -10, 1, 0)
    dropdownBtn.Position = UDim2.new(0.4, 10, 0, 0)
    dropdownBtn.BackgroundColor3 = library.theme.SectionColor
    dropdownBtn.TextColor3 = library.theme.FontColor
    dropdownBtn.Font = Enum.Font.SourceSans
    dropdownBtn.TextSize = 16
    dropdownBtn.Text = options[defaultIndex] or "Select"
    dropdownBtn.BorderSizePixel = 0
    dropdownBtn.Parent = container
    dropdownBtn.AutoButtonColor = true

    local dropdownOpen = false

    -- Dropdown list frame
    local listFrame = Instance.new("Frame")
    listFrame.Size = UDim2.new(0.6, -10, 0, 0)
    listFrame.Position = UDim2.new(0.4, 10, 1, 2)
    listFrame.BackgroundColor3 = library.theme.SectionColor
    listFrame.BorderSizePixel = 0
    listFrame.ClipsDescendants = true
    listFrame.Parent = container
    listFrame.Visible = false

    local listLayout = Instance.new("UIListLayout")
    listLayout.SortOrder = Enum.SortOrder.LayoutOrder
    listLayout.Padding = UDim.new(0, 2)
    listLayout.Parent = listFrame

    local function closeDropdown()
        dropdownOpen = false
        TweenService:Create(listFrame, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut),
            {Size = UDim2.new(listFrame.Size.X.Scale, listFrame.Size.X.Offset, 0, 0)}):Play()
        delay(0.2, function() listFrame.Visible = false end)
    end

    local function openDropdown()
        dropdownOpen = true
        listFrame.Visible = true
        local targetHeight = math.min(#options * 25, 150)
        TweenService:Create(listFrame, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut),
            {Size = UDim2.new(listFrame.Size.X.Scale, listFrame.Size.X.Offset, 0, targetHeight)}):Play()
    end

    dropdownBtn.MouseButton1Click:Connect(function()
        if dropdownOpen then
            closeDropdown()
        else
            openDropdown()
        end
    end)

    -- Populate list options
    for i, option in ipairs(options) do
        local optionBtn = Instance.new("TextButton")
        optionBtn.Size = UDim2.new(1, 0, 0, 25)
        optionBtn.BackgroundColor3 = library.theme.MainColor
        optionBtn.TextColor3 = library.theme.FontColor
        optionBtn.Font = Enum.Font.SourceSans
        optionBtn.TextSize = 14
        optionBtn.Text = option
        optionBtn.BorderSizePixel = 0
        optionBtn.Parent = listFrame

        optionBtn.MouseButton1Click:Connect(function()
            dropdownBtn.Text = option
            if callback then
                callback(option, i)
            end
            closeDropdown()
        end)
    end

    -- Initialize selection to default
    dropdownBtn.Text = options[defaultIndex] or "Select"

    return container
end

-- Notification system
local function createNotification(text, duration)
    duration = duration or 3
    local notifFrame = Instance.new("Frame")
    notifFrame.Size = UDim2.new(1, 0, 0, 40)
    notifFrame.BackgroundColor3 = library.theme.SectionColor
    notifFrame.BorderSizePixel = 0
    notifFrame.AnchorPoint = Vector2.new(1, 0)
    notifFrame.Position = UDim2.new(1, 0, 0, 0)
    notifFrame.Parent = notificationContainer
    notifFrame.ClipsDescendants = true
    notifFrame.BackgroundTransparency = 0

    local notifText = Instance.new("TextLabel")
    notifText.Size = UDim2.new(1, -10, 1, 0)
    notifText.Position = UDim2.new(0, 10, 0, 0)
    notifText.BackgroundTransparency = 1
    notifText.Text = text
    notifText.TextColor3 = library.theme.FontColor
    notifText.TextWrapped = true
    notifText.Font = Enum.Font.SourceSans
    notifText.TextSize = 14
    notifText.TextXAlignment = Enum.TextXAlignment.Left
    notifText.Parent = notifFrame

    notificationLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Wait()

    -- Animate in
    notifFrame.Position = UDim2.new(1, 50, 0, 0)
    notifFrame.BackgroundTransparency = 1
    TweenService:Create(notifFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {Position = UDim2.new(1, 0, 0, 0), BackgroundTransparency = 0}):Play()

    -- Auto dismiss
    delay(duration, function()
        TweenService:Create(notifFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.In),
            {Position = UDim2.new(1, 50, 0, 0), BackgroundTransparency = 1}):Play()
        wait(0.3)
        notifFrame:Destroy()
    end)
end

function library:Notify(text, duration)
    createNotification(text, duration)
end

-- Toggle window visibility
function library:ToggleWindow(state)
    gui.Enabled = state
end

-- Keybind to toggle UI visibility
function library:CreateKeybind(key)
    local bind = Enum.KeyCode[key] or Enum.KeyCode.RightShift
    UserInputService.InputBegan:Connect(function(input, gpe)
        if not gpe and input.KeyCode == bind then
            gui.Enabled = not gui.Enabled
        end
    end)
end

-- Minimize button functionality (collapse/expand whole window)
minimizeBtn.MouseButton1Click:Connect(function()
    if not isMinimized then
        -- Minimize: shrink window height to just header
        isMinimized = true
        TweenService:Create(mainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {Size = UDim2.new(0, 450, 0, 30)}):Play()
    else
        -- Expand to full size
        isMinimized = false
        TweenService:Create(mainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {Size = UDim2.new(0, 450, 0, 300)}):Play()
    end
end)

-- Auto-init keybind toggle
library:CreateKeybind("RightShift")

-- Return library for usage
return library
